import React, { useState, useCallback, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import styles from './ParkingAssignmentPage.module.css';
import axios from 'axios';
import { FaPlus, FaMinus, FaExpand, FaCar } from 'react-icons/fa';

const ParkingAssignmentPage = () => {
    const navigate = useNavigate();
    const { layoutId } = useParams();
    
    // Component state
    const [layout, setLayout] = useState(null);
    const [selectedSlot, setSelectedSlot] = useState(null);
    const [showForm, setShowForm] = useState(false);
    const [showBackground, setShowBackground] = useState(true);
    const [scale, setScale] = useState(1);
    const [position, setPosition] = useState({ x: 0, y: 0 });
    const [lines, setLines] = useState([]);
    const [texts, setTexts] = useState([]);
    const [isDragging, setIsDragging] = useState(false);
    const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
    const [loading, setLoading] = useState(true);
    const [assignments, setAssignments] = useState({});
    const [draggedAssignment, setDraggedAssignment] = useState(null);
    const [hoveredSlotId, setHoveredSlotId] = useState(null);
    const [formData, setFormData] = useState({
        assignee_type: 'guest',
        assignment_type: 'assign', // Adding this back for reservation support
        name: '',
        contact: '',
        vehicle_type: '',
        vehicle_plate: '',
        start_time: new Date().toISOString().slice(0, 16),
        end_time: '',
        purpose: ''
    });

    const fetchLayout = useCallback(async () => {
        try {
            const token = localStorage.getItem('token');
            const response = await axios.get(`http://localhost:8000/api/parking-layouts/${layoutId}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const layoutData = response.data;
       
            
            if (!layoutData || !layoutData.data) {
                throw new Error('No layout data found in response');
            }
            
            const rawLayoutData = layoutData.data.layout_data || {};
            
            // Ensure we have the proper data structure
            const processedLayout = {
                ...layoutData.data,
                layout_data: {
                    parking_slots: rawLayoutData.parking_slots || [],
                    lines: rawLayoutData.lines || [],
                    texts: rawLayoutData.texts || []
                },
                parking_slots: layoutData.data.parking_slots || []
            };
            
            // Add image path for the background image
            if (processedLayout.background_image) {
                processedLayout.image_path = `/storage/${processedLayout.background_image}`;
            }

            // Only log if the data has changed
            const layoutString = JSON.stringify(processedLayout);
            if (!layout || JSON.stringify(layout) !== layoutString) {
                console.log('Layout Data Updated:', {
                    raw: rawLayoutData,
                    processed: processedLayout.layout_data,
                    final: processedLayout
                });
            }
            
            // Extract elements from layout_data
            const { lines = [], texts = [] } = processedLayout.layout_data || {};
            
            // Ensure all slots have a space_status
            if (processedLayout.parking_slots) {
                processedLayout.parking_slots = processedLayout.parking_slots.map(slot => ({
                    ...slot,
                    space_status: slot.space_status || 'available'
                }));
            }

            // Set the extracted elements and layout data
            setLines(lines);
            setTexts(texts);
            setLayout(processedLayout);
            
            // Add debug logging
           
            setLoading(false);
        } catch (error) {
            console.error('Error fetching layout:', error);
            console.error('Error details:', error.response?.data);
            setLayout(null);
            setLoading(false);
        }
    }, [layoutId]);

    const fetchAssignments = useCallback(async () => {
        if (!layoutId) return; // Need layoutId to fetch assignments
        
        try {
            const token = localStorage.getItem('token');
            console.log('🔄 Starting assignment fetch cycle...');
            
            const response = await axios.get(`http://localhost:8000/api/parking-assignments/active`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            // Get assignments data
            const assignmentsData = response.data?.data || [];
            console.log('📥 Raw API Response:', response.data);
            
            // Create a single assignments map
            const newAssignmentsMap = {};
            
            // Process each assignment
            assignmentsData.forEach(assignment => {
                if (assignment && assignment.parking_slot_id) {
                    const slotId = String(assignment.parking_slot_id);
                    // Store full assignment data with consistent format
                    newAssignmentsMap[slotId] = {
                        ...assignment,
                        id: assignment.id,
                        name: assignment.name || '',
                        contact_number: assignment.contact_number || '',
                        vehicle_details: assignment.vehicle_details || '',
                        status: assignment.status || 'active',
                        is_reserved: assignment.is_reserved || false,
                        assignment_type: assignment.assignment_type || 'assign'
                    };
                    console.log(`Assignment loaded for slot ${slotId}:`, newAssignmentsMap[slotId]);
                }
            });
            
            console.log('New assignments map:', newAssignmentsMap);
            
            // First update assignments state to ensure it's available
            setAssignments(newAssignmentsMap);
            
            // Update layout slots to match assignments
            setLayout(prev => {
                if (!prev) return prev;
                console.log('🔄 Starting layout update cycle');
                
                const updatedSlots = prev.parking_slots?.map(slot => {
                    const slotId = String(slot.id);
                    const assignment = newAssignmentsMap[slotId];
                    
                    // Log slot processing
                    console.log(`📍 Processing slot ${slotId}:`, {
                        currentStatus: slot.space_status,
                        hasAssignment: !!assignment,
                        assignmentDetails: assignment
                    });
                    
                    if (!assignment) {
                        // If no assignment, ensure slot is marked as available
                        return {
                            ...slot,
                            space_status: 'available',
                            assignment_type: null,
                            status: 'available',
                            is_reserved: false
                        };
                    }
                    
                    // Determine if slot is reserved
                    const isReserved = assignment.status === 'reserved' || 
                                     assignment.is_reserved === true || 
                                     assignment.assignment_type === 'reserve';
                    
                    // Create updated slot with assignment data
                    const updatedSlot = {
                        ...slot,
                        space_status: isReserved ? 'reserved' : 'occupied',
                        assignment_type: isReserved ? 'reserve' : 'assign',
                        status: isReserved ? 'reserved' : 'active',
                        is_reserved: isReserved
                    };
                    
                    console.log(`✨ Slot ${slotId} updated:`, {
                        status: updatedSlot.space_status,
                        isReserved: updatedSlot.is_reserved,
                        hasAssignment: !!assignment
                    });
                    
                    return updatedSlot;
                }) || [];
                // Update layout with new slots
                const updatedLayout = {
                    ...prev,
                    parking_slots: updatedSlots
                };
                
                console.log('Final layout update:', {
                    totalSlots: updatedSlots.length,
                    occupiedSlots: updatedSlots.filter(s => s.space_status === 'occupied').length,
                    reservedSlots: updatedSlots.filter(s => s.space_status === 'reserved').length
                });
                
                return updatedLayout;
            });
        } catch (error) {
            console.error('Error fetching assignments:', error);
            if (error.response?.data?.message) {
                console.error('Server error:', error.response.data.message);
            }
            // Keep previous state on error
            return;
        }
    }, [layoutId]);

    useEffect(() => {
        // Fetch both layout and assignments on mount or when layoutId changes
        if (layoutId) {
            Promise.all([
                fetchLayout(),
                fetchAssignments()
            ]).then(() => {
                console.log('Initial data load complete');
            });
        }
    }, [layoutId, fetchLayout, fetchAssignments]);

    // Debug effect to track assignments and hover state
    useEffect(() => {
        console.log('State Update:', {
            assignmentsCount: Object.keys(assignments).length,
            assignments,
            hoveredSlotId,
            hasHoveredAssignment: hoveredSlotId ? !!assignments[String(hoveredSlotId)] : false,
            hoveredAssignment: hoveredSlotId ? assignments[String(hoveredSlotId)] : null
        });
    }, [assignments, hoveredSlotId]);

    // Effect to sync layout state with assignments
    useEffect(() => {
        if (!layout || Object.keys(assignments).length === 0) return;

        setLayout(prev => {
            if (!prev) return prev;
            
            const updatedSlots = prev.parking_slots?.map(slot => {
                const slotId = String(slot.id);
                const assignment = assignments[slotId];
                
                if (!assignment) {
                    return {
                        ...slot,
                        space_status: 'available',
                        assignment_type: null,
                        status: 'available',
                        is_reserved: false
                    };
                }
                
                const isReserved = assignment.status === 'reserved' || 
                                 assignment.is_reserved === true || 
                                 assignment.assignment_type === 'reserve';
                
                return {
                    ...slot,
                    space_status: isReserved ? 'reserved' : 'occupied',
                    assignment_type: isReserved ? 'reserve' : 'assign',
                    status: isReserved ? 'reserved' : 'active',
                    is_reserved: isReserved
                };
            });

            if (JSON.stringify(prev.parking_slots) === JSON.stringify(updatedSlots)) {
                return prev;
            }

            return {
                ...prev,
                parking_slots: updatedSlots
            };
        });
    }, [layout, assignments]);

    const handleSlotClick = (slot) => {
        console.log('Slot clicked:', {
            id: slot.id,
            space_number: slot.space_number,
            space_status: slot.space_status,
            full_slot: slot
        });

        const isOccupiedOrReserved = slot.space_status === 'occupied' || slot.space_status === 'reserved';
        
        if (!isOccupiedOrReserved) {
            console.log('Showing form for available slot:', slot.id);
            setSelectedSlot(slot);
            setShowForm(true);
            setFormData(prev => ({
                ...prev,
                parking_slot_id: slot.id
            }));
        } else {
            console.log('Form not shown because slot is occupied/reserved:', slot.space_status);
        }
    };

    const handleDragStart = (e, slot) => {
        if (slot.space_status === 'occupied' || slot.space_status === 'reserved') {
            e.stopPropagation();
            const assignment = assignments[String(slot.id)];
            console.log('Starting drag with assignment:', assignment);
            if (!assignment) {
                console.error('No assignment found for slot:', slot.id);
                return;
            }
            setDraggedAssignment(assignment);
            e.dataTransfer.setData('text/plain', slot.id);
            e.dataTransfer.effectAllowed = 'move';
        }
    };

    const handleDragEnd = (e) => {
        e.preventDefault();
        setDraggedAssignment(null);
        setIsDragging(false);
    };

    const handleDragOver = (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    };

    const handleDrop = async (e, targetSlot) => {
        e.preventDefault();
        e.stopPropagation();
        
        if (!draggedAssignment || !draggedAssignment.id) {
            console.error('No valid dragged assignment found');
            setDraggedAssignment(null);
            setIsDragging(false);
            return;
        }
        
        if (targetSlot.space_status === 'occupied') {
            console.error('Target slot is already occupied');
            setDraggedAssignment(null);
            setIsDragging(false);
            return;
        }

        try {
            const token = localStorage.getItem('token');
            await axios.post(
                `http://localhost:8000/api/parking-assignments/${draggedAssignment.id}/switch-parking`,
                {
                    new_slot_id: targetSlot.id
                },
                {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                }
            );

            // Get fresh data to ensure state is correct
            await Promise.all([fetchLayout(), fetchAssignments()]);
            setDraggedAssignment(null);
            setIsDragging(false);
            alert('Parking space reassigned successfully!');
        } catch (error) {
            console.error('Error reassigning space:', error);
            alert('Failed to reassign parking space: ' + (error.response?.data?.message || error.message));
        } finally {
            setDraggedAssignment(null);
            setIsDragging(false);
        }
    };

    const handleAssignment = async (e) => {
        e.preventDefault();
        try {
            const token = localStorage.getItem('token');
            
            const isReservation = formData.assignment_type === 'reserve';
            const assignmentData = {
                parking_slot_id: selectedSlot.id,
                name: formData.name,
                contact_number: formData.contact,
                vehicle_details: `${formData.vehicle_type} - ${formData.vehicle_plate}`,
                assignee_type: formData.assignee_type,
                assignee_id: null,
                start_time: formData.start_time,
                end_time: formData.end_time || null,
                notes: formData.purpose,
                status: isReservation ? 'reserved' : 'active',
                is_reserved: isReservation,
                assignment_type: isReservation ? 'reserve' : 'assign',
                reservation_status: isReservation ? 'reserved' : 'normal',
                slot_type: isReservation ? 'reserved' : 'regular'
            };
            
            await axios.post(
                'http://localhost:8000/api/parking-assignments',
                assignmentData,
                {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                }
            );

            // Get fresh data to ensure state is correct
            await Promise.all([fetchLayout(), fetchAssignments()]);
            
            setFormData({
                assignee_type: 'guest',
                assignment_type: 'assign',
                name: '',
                contact: '',
                vehicle_type: '',
                vehicle_plate: '',
                start_time: new Date().toISOString().slice(0, 16),
                end_time: '',
                purpose: ''
            });
            setSelectedSlot(null);
            setShowForm(false);
            
            alert(`Parking space ${isReservation ? 'reserved' : 'assigned'} successfully!`);
        } catch (error) {
            console.error('Error creating assignment:', error);
            alert('Failed to create parking assignment: ' + (error.response?.data?.message || error.message));
        }
    };

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: value
        }));
    };

    const handleMouseDown = useCallback((e) => {
        if (e.button === 0) {
            setIsDragging(true);
            setDragStart({
                x: e.clientX - position.x,
                y: e.clientY - position.y
            });
        }
    }, [position]);

    const handleMouseMove = useCallback((e) => {
        if (isDragging) {
            setPosition({
                x: e.clientX - dragStart.x,
                y: e.clientY - dragStart.y
            });
        }
    }, [isDragging, dragStart]);

    const handleMouseUp = useCallback(() => {
        setIsDragging(false);
    }, []);

    const handleWheel = useCallback((e) => {
        e.preventDefault();
        const delta = e.deltaY * -0.01;
        setScale(s => Math.min(Math.max(s + delta, 0.1), 4));
    }, []);

    const resetView = () => {
        setScale(1);
        setPosition({ x: 0, y: 0 });
    };

    if (loading) {
        return <div className={styles.loading}>Loading parking layout...</div>;
    }

    if (!layout) {
        return <div className={styles.error}>Error loading layout. Please try again.</div>;
    }

    // Removed unused variables 'total' and 'occupied'

    return (
        <div className={styles.pageContainer}>
            <div className={styles.header}>
                <button onClick={() => navigate('/home/parkingspaces')} className={styles.backButton}>
                    ← Back to Parking Spaces
                </button>
                <h1>{layout.name} - Select a Space to Assign</h1>
                <div className={styles.controls}>
                    <button onClick={() => setScale(s => Math.min(s + 0.1, 4))}><FaPlus /></button>
                    <button onClick={() => setScale(s => Math.max(s - 0.1, 0.1))}><FaMinus /></button>
                    <button onClick={resetView}><FaExpand /></button>
                    <button 
                        onClick={() => setShowBackground(!showBackground)}
                        className={`${styles.bgToggle} ${!showBackground ? styles.bgHidden : ''}`}
                    >
                        {showBackground ? 'Hide Background' : 'Show Background'}
                    </button>
                </div>
            </div>

            <div 
                className={styles.layoutSection}
                onMouseDown={handleMouseDown}
                onMouseMove={handleMouseMove}
                onMouseUp={handleMouseUp}
                onMouseLeave={handleMouseUp}
                onWheel={handleWheel}
            >
                <div className={styles.layoutWrapper}>
                    <div 
                        className={`${styles.layoutContainer} ${!showBackground ? styles.hideBg : ''}`}
                        style={{
                            backgroundImage: showBackground ? `url(http://localhost:8000${layout.image_path})` : 'none',
                            width: '1024px',
                            height: '768px',
                            transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`,
                            backgroundSize: '1024px 768px',
                            backgroundPosition: 'center',
                            backgroundRepeat: 'no-repeat',
                            position: 'relative',
                            pointerEvents: 'auto',
                            backgroundColor: !showBackground ? '#1a1a1a' : 'transparent'
                        }}
                        onDragOver={(e) => {
                            e.preventDefault();
                            e.stopPropagation();
                        }}
                    >
                        {/* Debug output */}
                        <div style={{ position: 'absolute', top: 0, left: 0, color: 'yellow', fontSize: '12px', zIndex: 1000 }}>
                            Lines: {lines.length}, Texts: {texts.length}
                        </div>

                        {/* Render lines */}
                        <svg
                            style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 1,
                                overflow: 'visible'
                            }}
                        >
                            {(lines || []).map((line, index) => (
                                <line
                                    key={`line-${index}`}
                                    x1={line.points?.[0] || 0}
                                    y1={line.points?.[1] || 0}
                                    x2={line.points?.[2] || 0}
                                    y2={line.points?.[3] || 0}
                                    stroke={line.color || '#fff'}
                                    strokeWidth={line.width || 2}
                                    vectorEffect="non-scaling-stroke"
                                />
                            ))}
                        </svg>

                        {/* Render texts */}
                        <svg
                            style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 2,
                                overflow: 'visible'
                            }}
                        >
                            {(texts || []).map((text, index) => (
                                <text
                                    key={`text-${index}`}
                                    x={text.x}
                                    y={text.y}
                                    fill={text.color || '#fff'}
                                    style={{ 
                                        fontSize: `${text.size || text.fontSize || 16}px`,
                                        textShadow: '1px 1px 2px black',
                                        userSelect: 'none'
                                    }}
                                    dominantBaseline="middle"
                                    textAnchor="middle"
                                    filter="drop-shadow(1px 1px 2px rgba(0,0,0,0.8))"
                                >
                                    {text.text || text.content || 'Text'}
                                </text>
                            ))}
                        </svg>

                        <div className={styles.slotMapWrapper}>
                            {layout.parking_slots.map(slot => {
                                console.log('Rendering slot:', {
                                    id: slot.id,
                                    space_number: slot.space_number,
                                    space_status: slot.space_status
                                });
                                const isAssigned = slot.space_status === 'occupied' || slot.space_status === 'reserved';
                                return (
                                    <div
                                        key={slot.id}
                                        className={`${styles.parkingSpace} 
                                            ${slot.space_status === 'reserved' ? styles.reserved : 
                                            slot.space_status === 'occupied' ? styles.occupied : ''}`}
                                        style={{
                                            left: slot.x_coordinate ? `${slot.x_coordinate}px` : `${slot.position_x}px`,
                                            top: slot.y_coordinate ? `${slot.y_coordinate}px` : `${slot.position_y}px`,
                                            width: `${slot.width}px`,
                                            height: `${slot.height}px`,
                                            transform: `rotate(${slot.rotation || 0}deg)`,
                                            position: 'absolute',
                                            pointerEvents: 'auto',
                                            cursor: 'pointer',
                                            zIndex: 10
                                        }}
                                        onClick={(e) => {
                                            e.preventDefault();
                                            e.stopPropagation();
                                            console.log('Click event fired on slot:', {
                                                id: slot.id,
                                                space_number: slot.space_number,
                                                space_status: slot.space_status,
                                                isAssigned
                                            });
                                            handleSlotClick(slot);
                                        }}
                                        draggable={isAssigned}
                                        onDragStart={(e) => handleDragStart(e, slot)}
                                        onDragEnd={handleDragEnd}
                                        onDragOver={handleDragOver}
                                        onDrop={(e) => handleDrop(e, slot)}
                                        onMouseEnter={() => {
                                            console.log('Mouse entered slot:', {
                                                slotId: slot.id,
                                                status: slot.space_status,
                                                hasAssignment: !!assignments[String(slot.id)],
                                                assignmentDetails: assignments[String(slot.id)],
                                                currentHoveredId: hoveredSlotId
                                            });
                                            setHoveredSlotId(slot.id);
                                        }}
                                        onMouseLeave={() => {
                                            console.log('Mouse left slot:', {
                                                slotId: slot.id,
                                                wasHovered: hoveredSlotId === slot.id
                                            });
                                            setHoveredSlotId(null);
                                        }}
                                    >
                                        <div className={styles.spaceNumber}>
                                            <div className={styles.slotContent}>
                                                {isAssigned ? (
                                                    <span>
                                                        <FaCar className={styles.carIcon} />
                                                        {slot.space_status === 'reserved' && <span className={styles.reservedTag}>R</span>}
                                                    </span>
                                                ) : (
                                                    <span>{slot.name || slot.space_number || slot.slot_number}</span>
                                                )}
                                            </div>
                                            {(() => {
                                                const shouldShowTooltip = (slot.space_status === 'occupied' || slot.space_status === 'reserved') && 
                                                                        assignments[String(slot.id)] && 
                                                                        hoveredSlotId === slot.id;
                                                
                                                console.log('Tooltip check for slot:', {
                                                    slotId: slot.id,
                                                    spaceStatus: slot.space_status,
                                                    hasAssignment: !!assignments[String(slot.id)],
                                                    hoveredSlotId,
                                                    shouldShow: shouldShowTooltip,
                                                    assignment: assignments[String(slot.id)]
                                                });

                                                if (!shouldShowTooltip) return null;
                                                
                                                return (
                                                    <div className={styles.tooltip}>
                                                        <div className={styles.tooltipContent}>
                                                            <div className={styles.tooltipRow}>
                                                                <span className={styles.tooltipLabel}>Name:</span>
                                                                <span>{assignments[String(slot.id)]?.name}</span>
                                                            </div>
                                                            <div className={styles.tooltipRow}>
                                                                <span className={styles.tooltipLabel}>Contact:</span>
                                                                <span>{assignments[String(slot.id)]?.contact_number}</span>
                                                            </div>
                                                            <div className={styles.tooltipRow}>
                                                                <span className={styles.tooltipLabel}>Vehicle:</span>
                                                                <span>{assignments[String(slot.id)]?.vehicle_details}</span>
                                                            </div>
                                                            <div className={styles.tooltipRow}>
                                                                <span className={styles.tooltipLabel}>Status:</span>
                                                                <span>{assignments[String(slot.id)]?.status}</span>
                                                            </div>
                                                        </div>
                                                        <button
                                                            className={styles.unassignButton}
                                                            onClick={async (e) => {
                                                                e.stopPropagation();
                                                                if (window.confirm('Are you sure you want to unassign this parking space?')) {
                                                                    try {
                                                                        const token = localStorage.getItem('token');
                                                                        const assignmentId = assignments[String(slot.id)]?.id;
                                                                        if (!assignmentId) throw new Error('No valid assignment ID found');
                                                                        await axios.post(
                                                                            `http://localhost:8000/api/parking-assignments/${assignmentId}/end`,
                                                                            {},
                                                                            {
                                                                                headers: {
                                                                                    'Authorization': `Bearer ${token}`,
                                                                                    'Accept': 'application/json',
                                                                                    'Content-Type': 'application/json'
                                                                                }
                                                                            }
                                                                        );
                                                                        
                                                                        // Get fresh data to ensure state is correct
                                                                        await Promise.all([fetchLayout(), fetchAssignments()]);
                                                                        alert('Parking space unassigned successfully!');
                                                                    } catch (error) {
                                                                        alert('Failed to unassign parking space');
                                                                    }
                                                                }
                                                            }}
                                                        >
                                                            Unassign
                                                        </button>
                                                    </div>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            </div>

            {showForm && (
                <div className={styles.formContainer}>
                    <div className={styles.formHeader}>
                        <h2>Assign Space {selectedSlot.slot_number}</h2>
                        <button 
                            className={styles.closeButton}
                            onClick={() => setShowForm(false)}
                        >
                            ×
                        </button>
                    </div>
                    
                    <form onSubmit={handleAssignment}>
                        <div className={styles.formGroup}>
                            <label>Type of Use</label>
                            <div className={styles.radioGroup}>
                                <label>
                                    <input
                                        type="radio"
                                        name="assignment_type"
                                        value="assign"
                                        checked={formData.assignment_type === 'assign'}
                                        onChange={handleInputChange}
                                    />
                                    Assign Now
                                </label>
                                <label>
                                    <input
                                        type="radio"
                                        name="assignment_type"
                                        value="reserve"
                                        checked={formData.assignment_type === 'reserve'}
                                        onChange={handleInputChange}
                                    />
                                    Reserve
                                </label>
                            </div>
                        </div>

                        <div className={styles.formGroup}>
                            <label>User Type</label>
                            <div className={styles.radioGroup}>
                                <label>
                                    <input
                                        type="radio"
                                        name="assignee_type"
                                        value="guest"
                                        checked={formData.assignee_type === 'guest'}
                                        onChange={handleInputChange}
                                    />
                                    Guest
                                </label>
                                <label>
                                    <input
                                        type="radio"
                                        name="assignee_type"
                                        value="faculty"
                                        checked={formData.assignee_type === 'faculty'}
                                        onChange={handleInputChange}
                                    />
                                    Faculty
                                </label>
                            </div>
                        </div>

                        <div className={styles.formGroup}>
                            <label>{formData.assignee_type === 'faculty' ? 'Faculty Name' : 'Guest Name'}</label>
                            <input
                                type="text"
                                name="name"
                                value={formData.name}
                                onChange={handleInputChange}
                                required
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label>Contact Number</label>
                            <input
                                type="text"
                                name="contact"
                                value={formData.contact}
                                onChange={handleInputChange}
                                required
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label>Vehicle Type</label>
                            <select
                                name="vehicle_type"
                                value={formData.vehicle_type}
                                onChange={handleInputChange}
                                required
                            >
                                <option value="">Select vehicle type</option>
                                <option value="car">Car</option>
                                <option value="motorcycle">Motorcycle</option>
                                <option value="bicycle">Bicycle</option>
                            </select>
                        </div>

                        <div className={styles.formGroup}>
                            <label>Vehicle Plate Number</label>
                            <input
                                type="text"
                                name="vehicle_plate"
                                value={formData.vehicle_plate}
                                onChange={handleInputChange}
                                required
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label>Start Time</label>
                            <input
                                type="datetime-local"
                                name="start_time"
                                value={formData.start_time}
                                onChange={handleInputChange}
                                required
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label>End Time (Optional)</label>
                            <input
                                type="datetime-local"
                                name="end_time"
                                value={formData.end_time}
                                onChange={handleInputChange}
                            />
                        </div>

                        <div className={styles.formGroup}>
                            <label>Purpose of Visit</label>
                            <textarea
                                name="purpose"
                                value={formData.purpose}
                                onChange={handleInputChange}
                                rows="3"
                                required
                            />
                        </div>

                        <div className={styles.formActions}>
                            <button 
                                type="submit" 
                                className={`${styles.submitButton} ${formData.assignment_type === 'reserve' ? styles.reserveButton : ''}`}
                            >
                                {formData.assignment_type === 'reserve' ? 'Reserve Space' : 'Assign Space'}
                            </button>
                        </div>
                    </form>
                </div>
            )}
        </div>
    );
};

export default ParkingAssignmentPage;


